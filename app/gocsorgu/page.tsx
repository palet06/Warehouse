"use client";
import { useEffect, useState } from "react";
import { format } from "date-fns";



export async function verileriAl() {
  const numbersArray = [
    "99942002678",
    "99772628482",
    "99780133718",
    "99468156930",
    "99027504578",
    "99275574682",
    "99416956346",
    "99056104374",
    "99200557018",
    "99272371314",
    "99851694124",
    "99929857604",
    "99294779310",
    "99863668038",
    "99876019346",
    "99518209890",
    "99613359858",
    "99972495082",
    "99392352248",
    "99656845912",
    "99016966400",
    "99721566162",
    "99076962862",
    "99608628020",
    "99410900888",
    "99042350822",
    "99123286224",
    "99947722212",
    "99440037882",
    "99464689814",
    "99178775384",
    "99269757992",
    "99474227082",
    "99146842520",
    "99965887450",
    "99599017278",
    "99652608320",
    "99053728610",
    "99101139160",
    "99902446238",
    "99179445828",
    "99515321410",
    "99041024380",
    "99661476682",
    "99647129120",
    "99219636308",
    "99240390972",
    "99726388226",
    "99570616070",
    "99354229182",
    "99131383670",
    "99696034994",
    "99083132364",
    "99475636302",
    "99790628594",
    "99770922780",
    "99398651932",
    "99383647896",
    "99872540172",
    "99787633440",
    "99218410756",
    "99201363250",
    "99041548404",
    "99122379798",
    "99116423230",
    "99958670700",
    "99096599826",
    "99067878622",
    "99982852462",
    "99671746256",
    "99181386386",
    "99875999724",
    "99651010674",
    "99942104884",
    "99937598896",
    "99597083190",
    "99644816108",
    "99888035662",
    "99287198104",
    "99808926988",
    "99185128104",
    "99485423688",
    "99860356006",
    "99397757758",
    "99332754316",
    "99641126132",
    "99418891324",
    "99885309438",
    "99900219964",
    "99766462672",
    "99360106408",
    "99414199332",
    "99167961750",
    "99483452970",
    "99769556804",
    "99221659890",
    "99725885238",
    "99456564334",
    "99563301556",
    "99936235556",
    "99497465508",
    "99455175678",
    "99713946828",
    "99958832160",
    "99086800178",
    "99243565520",
    "99845737844",
    "99648210032",
    "99725385356",
    "99761384108",
    "99230262586",
    "99953200186",
    "99945007632",
    "99006123516",
    "99757743056",
    "99422977908",
    "99617728650",
    "99474125258",
    "99850730540",
    "99336297918",
    "99106710418",
    "99539386822",
    "99143405162",
    "99814954234",
    "99285055980",
    "99045672686",
    "99066781220",
    "99211502830",
    "99300495784",
    "99096088122",
    "99062135386",
    "99006377506",
    "99667583452",
    "99952633534",
    "99242598536",
    "99968226416",
    "99728998720",
    "99100668098",
    "99071689122",
    "99553943490",
    "99368770526",
    "99351334872",
    "99605237584",
    "99839524122",
    "99588194812",
    "99137882658",
    "99980804524",
    "99941883742",
    "99013631394",
    "99608193634",
    "99014073834",
    "99324918320",
    "99278854316",
    "99728086694",
    "99753540888",
    "99865674846",
    "99404731726",
    "99964720444",
    "99870539864",
    "99660214186",
    "99404140900",
    "99960417140",
    "99398052128",
    "99907576978",
    "99329849520",
    "99330890146",
    "99177046980",
    "99974570954",
    "99962989652",
    "99211898940",
    "99329800224",
    "99380645284",
    "99310917122",
    "99534627128",
    "99557428504",
    "99284425654",
    "99387369138",
    "99680151188",
    "99769901932",
    "99213000396",
    "99614190986",
    "99478965164",
    "99158112376",
    "99056994708",
    "99819065928",
    "99277615758",
    "99333380064",
    "99444552800",
    "99810371424",
    "99510507680",
    "99711352096",
    "99154687076",
    "99857390426",
    "99856914494",
    "99704660764",
    "99158105446",
    "99866875402",
    "99018532276",
    "99443249138",
    "99452060892",
    "99993218998",
    "99896392634",
    "99788535880",
    "99791320268",
    "99483108990",
    "99552531100",
    "99798343260",
    "99533636206",
    "99836617346",
    "99531666106",
    "99476934506",
    "99510679400",
    "99335571620",
    "99521328144",
    "99041071360",
    "99364974416",
    "99235676692",
    "99140550834",
    "99298945476",
    "99884635866",
    "99737800632",
    "99056595356",
    "99981156110",
    "99488495422",
    "99106838914",
    "99182474150",
    "99517750430",
    "99167245294",
    "99057036582",
    "99633232940",
    "99277890988",
    "99783692328",
    "99072605008",
    "99759220722",
    "99164993426",
    "99526730898",
    "99639308816",
    "99897574626",
    "99368554256",
    "99248680242",
    "99441435458",
    "99437504786",
    "99083649794",
    "99980397408",
    "99423051508",
    "99023637706",
    "99179244544",
    "99146670406",
    "99990032382",
    "99582294334",
    "99590924940",
    "99053110828",
    "99774706188",
    "99185378202",
    "99255177230",
    "99983960654",
    "99209579684",
    "99090700228",
    "99604855826",
    "99041998650",
    "99683420304",
    "99636376740",
    "99788720538",
    "99751653566",
    "99666647698",
    "99240511674",
    "99258552072",
    "99817870920",
    "99566780426",
    "99617755762",
    "99371009996",
    "99852284164",
    "99536249984",
    "99437802844",
    "99108121168",
    "99257770736",
    "99407421242",
    "99045400562",
    "99497295778",
    "99414362750",
    "99648373638",
    "99433869056",
    "99531135152",
    "99704952364",
    "99538540508",
    "99913592962",
    "99083534618",
    "99896524158",
    "99263089938",
    "99569613592",
    "99634820764",
    "99653272520",
    "99897261540",
    "99655476674",
    "99977633014",
    "99417568470",
    "99418858686",
    "99727574000",
    "99767143556",
    "99921278322",
    "99707429276",
    "99285688768",
    "99373655580",
    "99103660464",
    "99603576500",
    "99158568630",
    "99348511774",
    "99390598822",
    "99005588330",
    "99808923390",
    "99947311294",
    "99758876098",
    "99348347816",
    "99948469468",
    "99049838842",
    "99561422918",
    "99164187184",
    "99451766962",
    "99071478498",
    "99219303422",
    "99108416660",
    "99809762684",
    "99537081002",
    "99219370370",
    "99988747540",
    "99347402356",
    "99083371718",
    "99148903496",
    "99455044516",
    "99005630978",
    "99317424920",
    "99167580050",
    "99950601054",
    "99212561218",
    "99914210308",
    "99951480634",
    "99488123554",
    "99971394652",
    "99696447510",
    "99548357684",
    "99844956598",
    "99195895904",
    "99658582068",
    "99256699656",
    "99903291394",
    "99470737714",
    "99199813010",
    "99452641336",
    "99515312746",
    "99256691872",
    "99063895098",
    "99687340400",
    "99443933600",
    "99313993512",
    "99722604436",
    "99161765026",
    "99564456514",
    "99092924790",
    "99194427274",
    "99967871624",
    "99948512928",
    "99387023696",
    "99873851796",
    "99755249864",
    "99623232028",
    "99404202202",
    "99636013232",
    "99135127096",
    "99573029464",
    "99953038208",
    "99416326460",
    "99020925400",
    "99752636186",
    "99707661904",
    "99929343008",
    "99839177946",
    "99554512572",
    "99078014750",
    "99347211736",
    "99476305924",
    "99050896398",
    "99704881084",
    "99728410864",
    "99313939848",
    "99822420264",
    "99781734198",
    "99182389560",
    "99053024934",
    "99545465030",
    "99406652494",
    "99542460380",
    "99677920650",
    "99347247612",
    "99880943842",
    "99154706494",
    "99675464392",
    "99955544448",
    "99822020440",
    "99432080308",
    "99128791006",
    "99286943774",
    "99671662310",
    "99529683214",
    "99117467622",
    "99946968628",
    "99451690182",
    "99260559724",
    "99217706348",
    "99430802926",
    "99463805802",
    "99600464626",
    "99878241288",
    "99205941560",
    "99153683284",
    "99590528940",
    "99959004184",
    "99476678714",
    "99338563196",
    "99885406694",
    "99833587260",
    "99116738082",
    "99167946696",
    "99189560658",
    "99377142192",
    "99437905668",
    "99128480528",
    "99049714238",
    "99292693526",
    "99042217644",
    "99260202538",
    "99137101810",
    "99253973254",
    "99602979180",
    "99575863776",
    "99805739178",
    "99864314576",
    "99415752642",
    "99368615322",
    "99031774066",
    "99709949130",
    "99931594290",
    "99639227018",
    "99132385178",
    "99660127820",
    "99878584064",
    "99066912822",
    "99469609800",
    "99025967030",
    "99821259926",
    "99367547808",
    "99827769030",
    "99602031628",
    "99389368184",
    "99743599162",
    "99251273042",
    "99009202584",
    "99206165514",
    "99005273274",
    "99472753040",
    "99704630446",
    "99236294802",
    "99296425758",
    "99772940164",
    "99319569056",
    "99245222476",
    "99641046188",
    "99966801288",
    "99311354612",
    "99561040846",
    "99265975710",
    "99464677798",
    "99783059022",
    "99141369800",
    "99807309454",
    "99335026670",
    "99463788532",
    "99366314494",
    "99673946418",
    "99145896876",
    "99163983794",
    "99281372494",
    "99284841072",
    "99299722762",
    "99938556352",
    "99797923128",
    "99332432498",
    "99922572948",
    "99599734588",
    "99435327776",
    "99971166266",
    "99945019994",
    "99651710222",
    "99434842126",
    "99152810544",
    "99442978596",
    "99286485922",
    "99428338758",
    "99321151034",
    "99012221466",
    "99086448356",
    "99463751284",
    "99948100156",
    "99833757618",
    "99191369478",
    "99914729640",
    "99435345800",
    "99314843540",
    "99604984694",
    "99089572560",
    "99069270394",
    "99044729206",
    "99803997464",
    "99751616622",
    "99473715566",
    "99059397438",
    "99152107262",
    "99795245314",
    "99359064870",
    "99870104604",
    "99929349284",
    "99703859336",
    "99054080106",
    "99776394666",
    "99530030694",
    "99458591796",
    "99998387248",
    "99021269480",
    "99104926156",
    "99488236100",
    "99589981176",
    "99068957586",
    "99197262858",
    "99313615186",
    "99890914740",
    "99048480080",
    "99300678170",
    "99281631560",
    "99985720492",
    "99293015020",
    "99770404910",
    "99332127196",
    "99218999084",
    "99023594214",
    "99703568344",
    "99802958718",
    "99038197400",
    "99415963512",
    "99312324430",
    "99372467276",
    "99563960692",
    "99010493544",
    "99257615150",
    "99816567012",
    "99842552846",
    "99683088696",
    "99507130778",
    "99253635428",
    "99245433414",
    "99287743762",
    "99275300274",
    "99247715914",
    "99284859992",
    "99834809910",
    "99367693338",
    "99623012620",
    "99364703450",
    "99104470666",
    "99884970790",
    "99943447874",
    "99400774246",
    "99936297790",
    "99134848398",
    "99089035980",
    "99273239880",
    "99363581790",
    "99759787102",
    "99236981658",
    "99121779308",
    "99737620698",
    "99864348922",
    "99965663610",
    "99077160144",
    "99046934486",
    "99896615856",
    "99398503972",
    "99636040412",
    "99681814310",
    "99443029976",
    "99695728320",
    "99440746340",
    "99654561814",
    "99452901324",
    "99794874478",
    "99436627400",
    "99302688320",
    "99985970422",
    "99953984208",
    "99083732540",
    "99755336984",
    "99603724482",
    "99210339444",
    "99032200588",
    "99971614286",
    "99912150354",
    "99828469106",
    "99869543452",
    "99030485222",
    "99596815754",
    "99061605668",
    "99489203262",
    "99608861434",
    "99755627358",
    "99059970716",
    "99845679298",
    "99173699418",
    "99000313678",
    "99051268460",
    "99875207164",
    "99752185882",
    "99117025228",
    "99429401222",
    "99542006038",
    "99515627598",
    "99501323596",
    "99446976284",
    "99968494266",
    "99884304274",
    "99527108382",
    "99150149110",
    "99201177826",
    "99468269722",
    "99810011504",
  ];
 
  const fetchPromises = numbersArray.map((number) =>
    
    fetch(
      `https://eizin.csgb.gov.tr/api/kisiBilgiStatuSorgula?tckNo=${number}`,
      {
        method: "GET",
        headers: {
          Authorization:
            "Bearer Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJtdXJhdC5oYXlhbG9nbHUiLCJleHAiOjE3Mzk3NTc5NDUsInVzZXIiOnsiaWQiOjU3MTQwMSwidXNlcm5hbWUiOiJtdXJhdC5oYXlhbG9nbHUiLCJwYXNzd29yZCI6bnVsbCwic2VsZWN0ZWRTa3kiOm51bGwsImF1dGhvcml0aWVzIjpbeyJhdXRob3JpdHkiOiJST0xFX1BUVF9TRVJWSUNFIn0seyJhdXRob3JpdHkiOiJST0xFX1RFS05JS19ERVNURUsifSx7ImF1dGhvcml0eSI6IlJPTEVfRURLIn1dLCJ0Y2tObyI6bnVsbCwiZmlyc3ROYW1lIjpudWxsLCJsYXN0TmFtZSI6bnVsbCwiZW1haWwiOm51bGwsImVtYWlsVmVyaWZpZWQiOmZhbHNlLCJwaG9uZU51bWJlciI6bnVsbCwicGhvbmVOdW1iZXJWZXJpZmllZCI6ZmFsc2UsImVuYWJsZWQiOnRydWUsImFjY291bnROb25FeHBpcmVkIjp0cnVlLCJhY2NvdW50Tm9uTG9ja2VkIjp0cnVlLCJjcmVkZW50aWFsc05vbkV4cGlyZWQiOnRydWUsImxkYXBMb2dpbkVuYWJsZWQiOmZhbHNlLCJwYXNzd29yZExvZ2luRW5hYmxlZCI6ZmFsc2UsImVkZXZsZXRMb2dpbkVuYWJsZWQiOmZhbHNlLCJjcmVhdGlvbkRhdGUiOm51bGwsImxhc3RMb2dpbkRhdGUiOm51bGwsInVzZXJSb2xlcyI6bnVsbCwidXNlclByaXZpbGVnZXMiOm51bGwsImF0dHJpYnV0ZXMiOm51bGx9LCJpc3MiOiJlaXppbi5pYy1zZXJ2aWNlIn0.PmnBzj86gUN3Iy7wu2ZyYHSasPPOM4EMmDupD5J6biI",
          "Content-Type": "application/json",
        },
      }
    )
      .then((response) => response.json())



      .catch((error) => {
        console.error(`Fetch error for post ${number}:`, error);
        return null;
      })
  );

  const results = await Promise.all(fetchPromises);
  

  

  return results;
}

export default function Home({ dataList }) {
  const [gocVerileri, setGocVerileri] = useState<any[]>([]);
  const [durum, setDurum] = useState("");
  useEffect(() => {
    const verileriGetir = async () => {
      setDurum(
        `Sorgu Başladı: ${format(new Date(Date.now()), "dd.MM.yyyy HH:mm")} - `
      );
      const veriler = await verileriAl();
      setGocVerileri(veriler);
      setDurum(
        (prev) =>
          prev +
          ` Sorgu Bitti: ${format(new Date(Date.now()), "dd.MM.yyyy HH:mm")}`
      );
    };

    verileriGetir();
  }, []);

  return (
    <div>
      <h1>Durum: - {durum}</h1>
      <ul>
        {gocVerileri.map((item, index) => (
          <li
            className="flex flex-col  gap-4 border-b border-green-500"
            key={index}
          >
            <h2>
              {item.kisi.ad} {item.kisi.soyad}
            </h2>

            {item.geciciKorumaBilgileriList.length > 1 &&
              item.geciciKorumaBilgileriList.map((tarih, i) => (
                <div className="flex flex-col gap-3 text-red-700" key={i}>
                  <p>GK Başlangıç Tarihi: {format(tarih.baslangicTarihi,"dd.MM.yyyy")}</p> -
                  <p>GK Sonlandırma Tarihi: {format(tarih.sonlandirmaTarihi,"dd.MM.yyyy")}</p>
                  <p>GK İptal Tarihi: {format(tarih.iptalTarihi,"dd.MM.yyyy")}</p>
                </div>
              ))}

            {item.geciciKorumaBilgileriList.length <= 1 && (
              <div className="flex flex-row justify-between gap-5">
                <p> GK Başlangıç Tarihi:
                  {format(
                    item.geciciKorumaBilgileriList[0].baslangicTarihi,
                    "dd.MM.yyyy"
                  )}
                </p>
                <p> GK Sonlandırma Tarihi:
                  {format(
                    item.geciciKorumaBilgileriList[0].sonlandirmaTarihi,
                    "dd.MM.yyyy"
                  )}
                </p>
                <p> GK İptal Tarihi:
                  {format(
                    item.geciciKorumaBilgileriList[0].iptalTarihi,
                    "dd.MM.yyyy"
                  )}
                </p>
              </div>
            )}
          </li>
        ))}
      </ul>
    </div>
  );
}
